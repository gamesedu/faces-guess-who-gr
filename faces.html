<!DOCTYPE html>

<html>
<head>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>Faces Puzzle Game</title>
	<meta name="generator" content="TextMate http://macromates.com/">
	<meta name="author" content="Gareth Senior">
<!--

TODO

* INTRO SCREENS
* COMPLETION SCREEN
	* # of questions
	* time
	* score
* GAME OVER
* LEVELS
* PORTRAIT LAYOUT
	- ctrls at the bottom of screen
	- tiles take up full width
* TIMER BAR	
* USE TOUCH EVENTS IF AVAILABLE
* PRELOAD IMAGES




-->
<style>
body {
	padding:5px;
	font-family:verdana,arial,sans-serif;
}
.screen {
	width:100%;
	height:100%;
	position:absolute;
	top:0;
	left:0;
	background:#fff;
	z-index:5;
}
#game {
	z-index:10;
}
ul#faces {
	margin:0;
	padding:0;
	width:83%;
	height:100% ;
	max-height:100%;
}

ul#faces li {
	display:inline-block;
	max-width:16%;
	text-align:center;
	text-align:center;
}
.portrait ul#faces li {
	max-width:25%;
}
ul#faces li span.card {
	position:relative;
	border:2px solid #369;
	background: #93a5ff; 
	background: -moz-radial-gradient(center, ellipse cover,  #ffffff 0%, #93a5ff 100%); /* FF3.6+ */
	background: -webkit-radial-gradient(center, ellipse cover,  #ffffff 0%,#93a5ff 100%); /* Chrome10+,Safari5.1+ */
	background: radial-gradient(ellipse at center,  #ffffff 0%,#93a5ff 100%); /* W3C */
	border-radius:5%;
	display:inline-block;
	margin:5px;
	overflow:hidden;
	width:95%;
	height:95%;
}
ul#faces li a {
	position:absolute;
	display:block;
	left:0;
	top:0;
	bottom:1.5em;
	right:0;
	text-align:center;
	
}
ul#faces li img {
	max-width:100%;
	max-height:100%;
	width:auto;
	height:auto;
}
ul#faces li span.name {
	display:block;
	background:#369;
	color:#fff;
	padding:.2em;
	text-align:center;
	position:absolute;
	bottom:0;
	left:0;
	right:0;
	font-weight:bold;
}
	ul#faces .eliminated span.card {
		border:2px solid #666;
		background:#999;
		opacity:.8;
	}
	ul#faces .eliminated img {
		visibility:hidden;
	}
	ul#faces .eliminated span.name {
		background:#666;
		color:#ccc;
		font-weight:normal;
	}
/* control panel */
#panel {
	position:absolute;
	right:0;
	top:0;
	width:16%;
	padding:1em;
}
#panel h2,
#panel h3,
#panel ul,
#panel li {
	margin:0;
	padding:0;
	list-style:none;
	font-weight:normal;
	font-size:1em;
}
div#questions h2 {
	position:absolute;
	left:-9999em;
}
div#questions {
	position:relative;
}
div#questions a {
	display:block;
	color:#fff;
	background:#369;
	margin:1px 0;
	padding:.2em;
	text-align:center;
	text-decoration:none;
}
div#response {
	position:absolute;
	left:0;
	right:0;
	top:0;
	bottom:0;
	border:3px solid #666;
	background:#ccc;
	font-size:48px;
	display:none;
}
div#response span {
	display:block;
	position:absolute;
	top:50%;
	width:100%;
	margin-top:-1em;
	text-align:center;
}
div#response.yes {
	border:3px solid #0f0;
	background:#393;
	color:#0f0;
}
div#response.no {
	border:3px solid #f00;
	background:#933;
	color:#f00;
}
div#response.dont-know {
	border:3px solid #00f;
	background:#339;
	color:#00f;
}
</style>
<script src="jquery-1.9.1-min.js"></script>
<script>

var faces = {

	answer: undefined,
	round: 1,
	score: 0,
	rows: 4,
	cols: 6,
	
	faceObjs: [],
	
	faces: [
		['Jackie', 	'short black', 	'?', 	'', 'male', 	'light', ''],
		['Soulja', 	'?', 	'?', 	'', 'male', 	'dark', 'spectacles hat'],
//		['Bjork', 	'long black', 	'green', 	'', 'female', 	'light', ''],
		['George', 	'long brown', 	'green', 	'moustache beard', 'male', 	'light', 'spectacles'],
//		['Michael', 'short black', 	'black', 	'', 'male', 	'light', 'spectacles'],
		['Katy', 	'long black', 	'blue', 	'', 'female', 	'light', ''],
		['Elton', 	'short brown',	'?', 	'', 'male', 	'light', 'spectacles'],
		['Ozzy', 	'long black', 	'black', 	'', 'male', 	'light', 'spectacles'],
		['Kanye',	'short black', 	'', 		'beard moustache', 'male', 	'dark', 'spectacles'],
//		['John', 	'long brown', 	'black', 	'', 'male', 		'light', 'spectacles'],
		['GaGa', 	'long blonde', 	'', 		'', 'female', 		'light', 'spectacles'],
		['Snoop', 	'long black', 	'brown', 	'beard moustache', 	'male', 	'dark', ''],
		['Ice-T', 	'?', 			'brown', 	'beard moustache', 	'male', 	'light', 'hat'],
		['Jessie', 	'long black', 	'blue', 	'', 				'female', 	'light', 'earrings'],
		['Bono', 	'short black', 	'?', 		'', 				'male', 		'light', 'spectacles'],
		['David', 	'short blonde', 'blue', 	'', 				'male', 		'light', ''],
		['Britney',	'bald', 		'black', 	'', 				'female', 		'light', 'earrings'],
//		['Freddie',	'short black', 	'black', 	'moustache', 		'male', 	'light', ''],
		['Polly',	'long black', 	'brown', 	'', 				'female', 	'light', 'earrings'],
		['Edge','?', 			'black', 	'moustache', 		'male', 	'light', 'hat'],
		['Alfred', 	'bald grey', 	'black', 	'', 				'male', 	'light', ''],
		['Stanley', 'bald grey', 	'black', 	'beard moustache',	'male',		'light', 'spectacles'],
		['Grace', 	'short black', 	'brown', 	'', 'female', 	'dark', ''],
//		['Bill', 	'short brown', 	'green', 	'', 'male', 	'light', ''],
		['Larry', 	'bald grey', 	'black', 	'', 'male', 	'light', 'spectacles'],
		['Jack', 	'long brown', 	'brown', 	'beard', 'male', 	'light', ''],
		['Annie', 	'short blonde', 'blue', 	'', 'female', 	'light', ''],
		['Lemmy', 	'long brown', 	'black', 	'moustache', 'male', 	'light', ''],
		['Will', 	'short black', 	'brown', 	'moustache', 'male', 	'dark', ''],
	],
	
	faces_left: [],
	
	init: function() {
		for (var f in this.faces) {
			var d = this.faces[f];
			this.faceObjs.push({
				'name': d[0],
				'img': "i/" + this.slug(d[0]) + ".png",
				'hair': d[1],
				'eyes': d[2],
				'facialhair': d[3],
				'gender': d[4],
				'skin': d[5],
				'access': d[6],
			});
		}
		this.assess_window();
		this.attach_questions();
	},

	remember_faces: function() {
		/* build an array of all the names */
		for (num in this.faces) {
			this.faces_left.push(this.faces[num][0]);
		}
	},
	
	slug: function(str) {
		/* takes a string and returns a simplified version for filenames and/or id values */
		return str.replace(/[\s]/g, '-').replace(/[^a-zA-Z0-9\-_]/g, '').toLowerCase();
	},
	
	start_game: function() {
		this.score = 0;
		this.round = 1;
		this.eliminates = 0;
		this.remember_faces();
		this.faceObjs = this.mix_array(this.faceObjs);
		this.answer = this.faceObjs[Math.floor(Math.random() * this.faceObjs.length)];
		this.render_board();
		
		this.countdown.start(60, $('#time'), this.game_over);
	},
	
	game_over: function() {
		alert("Game over");
	},
	
	render_board: function () {
		this.build_board();
		var that = this;
		setTimeout(function() { that.resize_board(); }, 1);
	},
	
	build_board: function() {
		var board = document.getElementById('faces');
		var h = '';
		var that = this;
		for (var d in this.faceObjs) {
			h += this.build_tile(this.faceObjs[d]);
		}
		board.innerHTML = h;
		// attach the cancel buttons
		$('ul#faces a').mousedown(function(e) {
			e.preventDefault();
			var $li = $(this).parent();//.closest('li');
			var classVal = $li.attr('class');
			if (classVal.indexOf('eliminated') > -1) {
				that.faces_left.push($(this).attr('data-name'));
			}
			else {
				that.faces_left = that.remove_from(that.faces_left, $(this).attr('data-name'));
			}
			$li.toggleClass('eliminated');
			if (that.faces_left.length === 1) {
				that.guess(that.faces_left[0]);
			}
		});
	},
	
	assess_window: function() {
		var h = window.innerHeight;
		var w = window.innerWidth;
		if (h>w) {
			orient = 'portrait';
			this.rows = 6;
			this.cols = 4;
		}
		else {
			orient = 'landscape';
			this.rows = 4;
			this.cols = 6;
		}
		$('body').attr('class', orient);
	},

	build_tile: function(face) {
		return tile = '<li><span class="card"><a href="#' + this.slug(face['name']) + '" data-name="' + face["name"] + '"><img draggable="false" src="' + face.img + '"></a><span class="name">' + face['name'] + '</span></span></li>';		
	},

	resize_board: function() {
		this.scale_tiles();
	},

	scale_tiles: function() {
		var board = $('#faces');
		var avail_width = board.innerWidth();
		var avail_height = board.innerHeight() - 15;
		$('#faces li').css('width', Math.floor(avail_width/this.cols) + 'px').css('height', Math.floor(avail_height/this.rows) + 'px');
	},
	
	mix_array: function(arr) {
		/*
		function that takes an array and returns a mixed version
		*/
		var new_arr = [];
		var len = arr.length;
		var rnd, entry;
		for (var i=0; i<len ;i++) {
			rnd = Math.floor(Math.random() * (len - i));
			entry = arr.splice(rnd, 1);
			new_arr.push(entry[0]);
		}
		return new_arr;
	},
	
	remove_from: function(arr, val) {
		/* removes a given vale from an array */
		var pos = arr.indexOf(val);
		if (pos > -1) {
			var arr1 = arr.splice(0, pos)
			var arr2 = arr.slice(1);
			return arr1.concat(arr2);
		}
		return arr;
	},
	
	respond: function(val) {
		/*
		display the yes/no/don't-know answer
		*/
		var $response = $('#response');
		$response.attr('class', this.slug(val)).html('<span>'+val+'</span>');
		$response.show();
		setTimeout(function() {
			$response.hide();
		}, 750);
	},
	
	question: function(attr, value) {
		if (this.answer[attr].indexOf('?') !== -1) return "Don't Know";
		return !!(this.answer[attr].indexOf(value) + 1) ? "Yes":"No";
	},
	
	attach_questions: function() {
		var that = this;
		$('#questions a').click(function(e) {
			/* get the link id, clean it, split it on underscore, test the attribute (0) for the value (1) */
			var href = $(this).attr('href').replace('#', '');
			var bits = href.split('_');
			that.respond(that.question(bits[0], bits[1]));
			e.preventDefault();
		});
	},
	
	guess: function(name) {
		if (name === this.answer['name']) alert("Correct! It was " + name);
		else alert("No, it's not " + name);
	},
	
	countdown: {

		_st_time:0,
		_st_num:0,
		_display:0,
		_running: false,
		
		start: function(num, $output, cback) {
			this.$output = $output;
			this.callback = cback;
			var now = new Date();
			this._st_time = now.getTime();
			this._st_num = num;
			this._display = num;
			this._running = true;
			this.display();
		},

		display:function () {
			var now = new Date();
			var elapsed = now.getTime() - this._st_time;
			this._display = this._st_num - Math.floor(elapsed/1000);
			if (this._display < 0) {
				this.callback();
			}
			else {
				this.$output.html(this._display)
				this._temp = setTimeout(function() {
					if (faces.countdown._running) {
						faces.countdown.display();
					}
				}, 499);
			}
		},
		
		stop: function() {
			this._running = false;
			return this._display;
		},

	}
};

$(document).ready(function() {
	faces.init();
	faces.start_game();
});

</script>
</head>
<body>
	
	<h1>Faces</h1>
	
	<ul id="nav">
		<li><a href="#about">About</a></li>
		<li><a href="#game">Play</a></li>
		<li><a href="#instructions">Instructions</a></li>
	</ul>
	
	
<div id="page">

	<div id="about" class="screen">
		<p>"Faces" is an online puzzle game. It is written in HTML and JavaScript and was designed to be played in a web-browser</p>
		<p>"Faces" is nothing at all like "Guess Who?", a popular game created by Ora and Theo Coster and first produced by MB Games then later by Hasbro.</p>
		<p>The "Faces" game engine was written by Gareth Senior, first in Adobe Flash and ActionScript to tie in with a "1k Runaway" competition that ran on Power FM, and later refined as a standalone game.</p>
	</div>

	<div id="game" class="screen">
		<div id="panel">
			<h2>Time <span id="time">90</span></h2>

			<div id="questions">
				<div id="response"></div>
				<h2>Questions</h2>
				<ul>
					<li><a href="#hair_black">Black hair</a></li>
					<li><a href="#hair_brown">Brown hair</a></li>
					<li><a href="#hair_blonde">Blonde hair</a></li>
					<li><a href="#hair_grey">Grey hair</a></li>
					<li><a href="#hair_long">Long hair</a></li>
					<li><a href="#hair_short">Short hair</a></li>
					<li><a href="#hair_bald">Bald</a></li>
					<li><a href="#gender_female">Female</a></li>
					<li><a href="#gender_male">Male</a></li>
					<li><a href="#eyes_blue">Blue eyes</a></li>
					<li><a href="#eyes_brown">Brown eyes</a></li>
					<li><a href="#eyes_black">Black eyes</a></li>
					<li><a href="#skin_dark">Dark skin</a></li>
					<li><a href="#skin_light">Light skin</a></li>
					<li><a href="#facialhair_beard">Beard</a></li>
					<li><a href="#facialhair_brown">Moustache</a></li>
					<li><a href="#access_hat">Hat</a></li>
					<li><a href="#access_earrings">Ear-rings</a></li>
					<li><a href="#access_spectacles">Spectacles</a></li>
				</ul>
			</div>
		</div>

		<ul id="faces">
	
		</ul>

	</div>

	<div id="instructions" class="screen">
		<h2>How To Play</h2>
		<p>Guess...</p>
	</div>

</div>

</body>
</html>